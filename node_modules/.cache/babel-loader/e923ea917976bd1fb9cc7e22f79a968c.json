{"remainingRequest":"E:\\ApiAdmin\\node_modules\\thread-loader\\dist\\cjs.js!E:\\ApiAdmin\\node_modules\\babel-loader\\lib\\index.js!E:\\ApiAdmin\\node_modules\\eslint-loader\\index.js??ref--13-0!E:\\ApiAdmin\\src\\router\\index.js","dependencies":[{"path":"E:\\ApiAdmin\\src\\router\\index.js","mtime":1635783328994},{"path":"E:\\ApiAdmin\\.babelrc","mtime":1635783328909},{"path":"E:\\ApiAdmin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1635783567026},{"path":"E:\\ApiAdmin\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1635783565708},{"path":"E:\\ApiAdmin\\node_modules\\babel-loader\\lib\\index.js","mtime":1635783561745},{"path":"E:\\ApiAdmin\\node_modules\\eslint-loader\\index.js","mtime":1635783566509}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport Vue from 'vue';\nimport Router from 'vue-router';\nimport routes from \"./routers\";\nimport store from '@/store';\nimport iView from 'view-design';\nimport { setToken, getToken, setTitle } from '@/libs/util';\nimport { oneOf } from '@/libs/tools';\nVue.use(Router);\n\nvar createRouter = function createRouter() {\n  return new Router({\n    routes: routes\n  });\n};\n\nvar router = createRouter();\nrouter.beforeEach(function (to, from, next) {\n  iView.LoadingBar.start();\n  var token = getToken();\n\n  if (to.name.indexOf('wiki_') === -1) {\n    if (!token && to.name !== 'login') {\n      // 未登录且要跳转的页面不是登录页\n      next({\n        name: 'login'\n      });\n    } else if (!token && to.name === 'login') {\n      // 未登陆且要跳转的页面是登录页\n      next();\n    } else if (token && to.name === 'login') {\n      // 已登录且要跳转的页面是登录页\n      next({\n        name: 'home'\n      });\n    } else {\n      store.dispatch('getUserInfo').then(function (user) {\n        // 路由中有相关配置才会识别并且鉴权，否则认为不需要鉴权\n        if (to.meta && to.meta.access) {\n          if (oneOf(to.meta.access, user.access)) {\n            // 有权限，可访问\n            next();\n          } else {\n            // 无权限，重定向到401页面\n            next({\n              replace: true,\n              name: 'error_401'\n            });\n          }\n        } else {\n          next();\n        }\n      }).catch(function () {\n        setToken('');\n        next({\n          name: 'login'\n        });\n      });\n    }\n  } else {\n    if (!token && to.name !== 'wiki_login') {\n      // 未登录且要跳转的页面不是登录页\n      next({\n        name: 'wiki_login'\n      });\n    } else if (!token && to.name === 'wiki_login') {\n      // 未登陆且要跳转的页面是登录页\n      next();\n    } else if (token && to.name === 'wiki_login') {\n      // 已登录且要跳转的页面是登录页\n      next({\n        name: 'wiki_list'\n      });\n    } else {\n      next();\n    }\n  }\n});\nrouter.afterEach(function (to) {\n  setTitle(to, router.app);\n  iView.LoadingBar.finish();\n  window.scrollTo(0, 0);\n});\nexport function resetRouter() {\n  var newRouter = createRouter();\n  router.matcher = newRouter.matcher; // the relevant part\n}\nexport default router;",null]}