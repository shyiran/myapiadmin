{"remainingRequest":"E:\\ApiAdmin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\ApiAdmin\\src\\view\\system\\auth.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\ApiAdmin\\src\\view\\system\\auth.vue","mtime":1635783329023},{"path":"E:\\ApiAdmin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1635783567026},{"path":"E:\\ApiAdmin\\node_modules\\babel-loader\\lib\\index.js","mtime":1635783561745},{"path":"E:\\ApiAdmin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1635783567026},{"path":"E:\\ApiAdmin\\node_modules\\vue-loader\\lib\\index.js","mtime":1635783560295}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { getUsers } from '@/api/user'\r\nimport { getList, add, edit, del, delMember, getRuleList, changeStatus, editRule } from '@/api/auth'\r\n\r\nconst editButton = (vm, h, currentRow, index) => {\r\n  if (vm.buttonShow.edit) {\r\n    return h('Button', {\r\n      props: {\r\n        type: 'primary'\r\n      },\r\n      style: {\r\n        margin: '0 5px'\r\n      },\r\n      on: {\r\n        'click': () => {\r\n          vm.formItem.id = currentRow.id\r\n          vm.formItem.name = currentRow.name\r\n          vm.formItem.description = currentRow.description\r\n          vm.modalSetting.show = true\r\n          vm.modalSetting.index = index\r\n        }\r\n      }\r\n    }, vm.$t('edit_button'))\r\n  }\r\n}\r\nconst authButton = (vm, h, currentRow, index) => {\r\n  if (vm.buttonShow.edit) {\r\n    return h('Button', {\r\n      props: {\r\n        type: 'info',\r\n        ghost: true\r\n      },\r\n      style: {\r\n        margin: '0 5px'\r\n      },\r\n      on: {\r\n        'click': () => {\r\n          vm.formItem.id = currentRow.id\r\n          getRuleList({ 'group_id': currentRow.id }).then(response => {\r\n            vm.ruleList = response.data.data.list\r\n          })\r\n          vm.authSetting.show = true\r\n          vm.authSetting.index = index\r\n        }\r\n      }\r\n    }, '设置权限')\r\n  }\r\n}\r\nconst deleteButton = (vm, h, currentRow, index) => {\r\n  if (vm.buttonShow.del) {\r\n    return h('Poptip', {\r\n      props: {\r\n        confirm: true,\r\n        title: '您确定要删除这条数据吗? ',\r\n        transfer: true\r\n      },\r\n      on: {\r\n        'on-ok': () => {\r\n          del(currentRow.id).then(response => {\r\n            vm.tableData.splice(index, 1)\r\n            vm.$Message.success(response.data.msg)\r\n          })\r\n        }\r\n      }\r\n    }, [\r\n      h('Button', {\r\n        style: {\r\n          margin: '0 5px'\r\n        },\r\n        props: {\r\n          type: 'error',\r\n          placement: 'top',\r\n          loading: currentRow.isDeleting\r\n        }\r\n      }, vm.$t('delete_button'))\r\n    ])\r\n  }\r\n}\r\nconst memberButton = (vm, h, currentRow, index) => {\r\n  if (vm.buttonShow.memberList) {\r\n    return h('Button', {\r\n      props: {\r\n        type: 'primary'\r\n      },\r\n      style: {\r\n        margin: '0 5px'\r\n      },\r\n      on: {\r\n        'click': () => {\r\n          vm.memberSetting.show = true\r\n          vm.memberShow.gid = currentRow.id\r\n          vm.getMemberList()\r\n        }\r\n      }\r\n    }, '组成员')\r\n  }\r\n}\r\nconst memberDelButton = (vm, h, currentRow, index) => {\r\n  if (vm.buttonShow.memberDel) {\r\n    return h('Poptip', {\r\n      props: {\r\n        confirm: true,\r\n        title: '您确定要删除这条数据吗? ',\r\n        transfer: true\r\n      },\r\n      on: {\r\n        'on-ok': () => {\r\n          delMember({\r\n            uid: currentRow.id,\r\n            gid: vm.memberShow.gid\r\n          }).then(response => {\r\n            vm.memberData.splice(index, 1)\r\n            vm.$Message.success(response.data.msg)\r\n          })\r\n        }\r\n      }\r\n    }, [\r\n      h('Button', {\r\n        style: {\r\n          margin: '0 5px'\r\n        },\r\n        props: {\r\n          type: 'error',\r\n          placement: 'top',\r\n          loading: currentRow.isDeleting\r\n        }\r\n      }, vm.$t('delete_button'))\r\n    ])\r\n  }\r\n}\r\n\r\nexport default {\r\n  name: 'system_auth',\r\n  data () {\r\n    return {\r\n      ruleList: [],\r\n      columnsList: [\r\n        {\r\n          title: '序号',\r\n          type: 'index',\r\n          width: 65,\r\n          align: 'center'\r\n        },\r\n        {\r\n          title: '权限组',\r\n          align: 'center',\r\n          key: 'name',\r\n          width: 200\r\n        },\r\n        {\r\n          title: '描述',\r\n          align: 'center',\r\n          key: 'description'\r\n        },\r\n        {\r\n          title: '成员授权',\r\n          align: 'center',\r\n          width: 116,\r\n          render: (h, params) => {\r\n            return h('div', [\r\n              memberButton(this, h, params.row, params.index)\r\n            ])\r\n          }\r\n        },\r\n        {\r\n          title: '状态',\r\n          align: 'center',\r\n          width: 100,\r\n          render: (h, params) => {\r\n            let vm = this\r\n            return h('i-switch', {\r\n              attrs: {\r\n                size: 'large'\r\n              },\r\n              props: {\r\n                'true-value': 1,\r\n                'false-value': 0,\r\n                value: params.row.status,\r\n                disabled: !vm.buttonShow.changeStatus\r\n              },\r\n              on: {\r\n                'on-change': function (status) {\r\n                  changeStatus(status, params.row.id).then(response => {\r\n                    vm.$Message.success(response.data.msg)\r\n                    vm.getList()\r\n                  })\r\n                }\r\n              }\r\n            }, [\r\n              h('span', {\r\n                slot: 'open'\r\n              }, vm.$t('open_choose')),\r\n              h('span', {\r\n                slot: 'close'\r\n              }, vm.$t('close_choose'))\r\n            ])\r\n          }\r\n        },\r\n        {\r\n          title: '操作',\r\n          align: 'center',\r\n          width: 285,\r\n          render: (h, params) => {\r\n            return h('div', [\r\n              authButton(this, h, params.row, params.index),\r\n              editButton(this, h, params.row, params.index),\r\n              deleteButton(this, h, params.row, params.index)\r\n            ])\r\n          }\r\n        }\r\n      ],\r\n      memberColumns: [\r\n        {\r\n          title: '序号',\r\n          type: 'index',\r\n          width: 65,\r\n          align: 'center'\r\n        },\r\n        {\r\n          title: '用户账号',\r\n          align: 'center',\r\n          key: 'username'\r\n        },\r\n        {\r\n          title: '用户昵称',\r\n          align: 'center',\r\n          key: 'nickname',\r\n          width: 100\r\n        },\r\n        {\r\n          title: '登录次数',\r\n          align: 'center',\r\n          key: 'login_times',\r\n          width: 100\r\n        },\r\n        {\r\n          title: '最后登录时间',\r\n          align: 'center',\r\n          key: 'last_login_time',\r\n          width: 140\r\n        },\r\n        {\r\n          title: '最后登录IP',\r\n          align: 'center',\r\n          key: 'last_login_ip',\r\n          width: 160\r\n        },\r\n        {\r\n          title: '状态',\r\n          align: 'center',\r\n          width: 100,\r\n          render: (h, params) => {\r\n            if (params.row.status === 1) {\r\n              return h('Tag', {\r\n                props: {\r\n                  'color': 'green'\r\n                }\r\n              }, '启用')\r\n            } else {\r\n              return h('Tag', {\r\n                props: {\r\n                  'color': 'red'\r\n                }\r\n              }, vm.$t('close_choose'))\r\n            }\r\n          }\r\n        },\r\n        {\r\n          title: '操作',\r\n          align: 'center',\r\n          width: 115,\r\n          render: (h, params) => {\r\n            return h('div', [\r\n              memberDelButton(this, h, params.row, params.index)\r\n            ])\r\n          }\r\n        }\r\n      ],\r\n      tableData: [],\r\n      memberData: [],\r\n      tableShow: {\r\n        currentPage: 1,\r\n        pageSize: 10,\r\n        listCount: 0\r\n      },\r\n      memberShow: {\r\n        currentPage: 1,\r\n        pageSize: 10,\r\n        listCount: 0,\r\n        gid: 0\r\n      },\r\n      searchConf: {\r\n        keywords: '',\r\n        status: ''\r\n      },\r\n      modalSetting: {\r\n        show: false,\r\n        loading: false,\r\n        index: 0\r\n      },\r\n      authSetting: {\r\n        show: false,\r\n        loading: false,\r\n        index: 0\r\n      },\r\n      memberSetting: {\r\n        show: false,\r\n        loading: false,\r\n        index: 0\r\n      },\r\n      formItem: {\r\n        name: '',\r\n        description: '',\r\n        rules: [],\r\n        id: 0\r\n      },\r\n      ruleValidate: {\r\n        name: [\r\n          { required: true, message: '组名称不能为空', trigger: 'blur' }\r\n        ]\r\n      },\r\n      buttonShow: {\r\n        edit: true,\r\n        del: true,\r\n        changeStatus: true,\r\n        memberDel: true,\r\n        memberList: true\r\n      },\r\n      listLoading: false,\r\n      memberLoading: false\r\n    }\r\n  },\r\n  created () {\r\n    let vm = this\r\n    vm.getList()\r\n    vm.hasRule('Auth/edit').then(res => {\r\n      vm.buttonShow.edit = res\r\n    })\r\n    vm.hasRule('Auth/del').then(res => {\r\n      vm.buttonShow.del = res\r\n    })\r\n    vm.hasRule('Auth/changeStatus').then(res => {\r\n      vm.buttonShow.changeStatus = res\r\n    })\r\n    vm.hasRule('User/getUsers').then(res => {\r\n      vm.buttonShow.memberList = res\r\n    })\r\n    vm.hasRule('Auth/delMember').then(res => {\r\n      vm.buttonShow.memberDel = res\r\n    })\r\n  },\r\n  methods: {\r\n    authEdit () {\r\n      let vm = this\r\n      vm.formItem.rules = []\r\n      let ruleNodes = vm.$refs['formTree'].getCheckedNodes()\r\n      let ruleLength = ruleNodes.length\r\n      if (ruleLength) {\r\n        for (let i = 0; i <= ruleLength - 1; i++) {\r\n          this.formItem.rules.push(ruleNodes[i]['key'])\r\n        }\r\n      }\r\n\r\n      vm.authSetting.loading = true\r\n      editRule(vm.formItem).then(response => {\r\n        vm.$Message.success(response.data.msg)\r\n        vm.authSetting.show = false\r\n        vm.authSetting.loading = false\r\n      }).catch(() => {\r\n        vm.authSetting.loading = false\r\n      })\r\n    },\r\n    alertAdd () {\r\n      this.modalSetting.show = true\r\n    },\r\n    submit () {\r\n      let vm = this\r\n      this.$refs['myForm'].validate((valid) => {\r\n        if (valid) {\r\n          vm.modalSetting.loading = true\r\n          if (vm.formItem.id === 0) {\r\n            add(vm.formItem).then(response => {\r\n              vm.$Message.success(response.data.msg)\r\n              vm.getList()\r\n              vm.cancel()\r\n            }).catch(() => {\r\n              vm.modalSetting.loading = false\r\n            })\r\n          } else {\r\n            edit(vm.formItem).then(response => {\r\n              vm.$Message.success(response.data.msg)\r\n              vm.getList()\r\n              vm.cancel()\r\n            }).catch(() => {\r\n              vm.modalSetting.loading = false\r\n            })\r\n          }\r\n        }\r\n      })\r\n    },\r\n    cancel () {\r\n      this.modalSetting.show = false\r\n    },\r\n    doCancel (data) {\r\n      if (!data) {\r\n        this.formItem.id = 0\r\n        this.$refs['myForm'].resetFields()\r\n        this.modalSetting.loading = false\r\n        this.modalSetting.index = 0\r\n      }\r\n    },\r\n    changePage (page) {\r\n      this.tableShow.currentPage = page\r\n      this.getList()\r\n    },\r\n    changeSize (size) {\r\n      this.tableShow.pageSize = size\r\n      this.getList()\r\n    },\r\n    changeMemberPage (page) {\r\n      this.memberShow.currentPage = page\r\n      this.getMemberList()\r\n    },\r\n    changeMemberSize (size) {\r\n      this.memberShow.pageSize = size\r\n      this.getMemberList()\r\n    },\r\n    search () {\r\n      this.tableShow.currentPage = 1\r\n      this.getList()\r\n    },\r\n    getList () {\r\n      let vm = this\r\n      let params = {\r\n        page: vm.tableShow.currentPage,\r\n        size: vm.tableShow.pageSize,\r\n        keywords: vm.searchConf.keywords,\r\n        status: vm.searchConf.status\r\n      }\r\n      vm.listLoading = true\r\n      getList(params).then(response => {\r\n        vm.tableData = response.data.data.list\r\n        vm.tableShow.listCount = response.data.data.count\r\n        vm.listLoading = false\r\n      })\r\n    },\r\n    getMemberList () {\r\n      let vm = this\r\n      let params = {\r\n        page: vm.memberShow.currentPage,\r\n        size: vm.memberShow.pageSize,\r\n        gid: vm.memberShow.gid\r\n      }\r\n      vm.memberLoading = true\r\n      getUsers(params).then(response => {\r\n        vm.memberData = response.data.data.list\r\n        vm.memberShow.listCount = response.data.data.count\r\n        vm.memberLoading = false\r\n      })\r\n    }\r\n  }\r\n}\r\n",{"version":3,"sources":["auth.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2FA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"auth.vue","sourceRoot":"src/view/system","sourcesContent":["<style lang=\"less\" scoped>\r\n  @import './auth.less';\r\n</style>\r\n<template>\r\n  <div>\r\n    <Row>\r\n      <Col span=\"24\">\r\n        <Card class=\"margin-bottom-10\">\r\n          <Form inline>\r\n            <FormItem class=\"margin-bottom-0\">\r\n              <Select v-model=\"searchConf.status\" clearable placeholder='请选择状态' style=\"width:120px\">\r\n                <Option :value=\"1\">启用</Option>\r\n                <Option :value=\"0\">禁用</Option>\r\n              </Select>\r\n            </FormItem>\r\n            <FormItem class=\"margin-bottom-0\">\r\n              <Input v-model=\"searchConf.keywords\" placeholder=\"请输入组名称\"></Input>\r\n            </FormItem>\r\n            <FormItem class=\"margin-bottom-0\">\r\n              <Button type=\"primary\" @click=\"search\">{{ $t('find_button') }}/{{ $t('refresh_button') }}</Button>\r\n            </FormItem>\r\n          </Form>\r\n        </Card>\r\n      </Col>\r\n    </Row>\r\n    <Row>\r\n      <Col span=\"24\">\r\n        <Card>\r\n          <div class=\"margin-bottom-15\">\r\n            <Button type=\"primary\" v-has=\"'Auth/add'\" @click=\"alertAdd\" icon=\"md-add\">{{ $t('add_button') }}</Button>\r\n          </div>\r\n          <div>\r\n            <Table :loading=\"listLoading\" :columns=\"columnsList\" :data=\"tableData\" border disabled-hover></Table>\r\n          </div>\r\n          <div class=\"margin-top-15\" style=\"text-align: center\">\r\n            <Page :total=\"tableShow.listCount\" :current=\"tableShow.currentPage\"\r\n                  :page-size=\"tableShow.pageSize\" @on-change=\"changePage\"\r\n                  @on-page-size-change=\"changeSize\" show-elevator show-sizer show-total></Page>\r\n          </div>\r\n        </Card>\r\n      </Col>\r\n    </Row>\r\n    <Modal v-model=\"modalSetting.show\" width=\"668\" :styles=\"{top: '30px'}\" @on-visible-change=\"doCancel\">\r\n      <p slot=\"header\" style=\"color:#2d8cf0\">\r\n        <Icon type=\"md-alert\"></Icon>\r\n        <span>{{formItem.id ? '编辑' : '新增'}}权限组</span>\r\n      </p>\r\n      <Form ref=\"myForm\" :rules=\"ruleValidate\" :model=\"formItem\" :label-width=\"80\">\r\n        <FormItem label=\"组名称\" prop=\"name\">\r\n          <Input v-model=\"formItem.name\" placeholder=\"请输入权限组名称\"></Input>\r\n        </FormItem>\r\n        <FormItem label=\"组描述\" prop=\"description\">\r\n          <Input type=\"textarea\" v-model=\"formItem.description\" placeholder=\"请输入权限组描述\"></Input>\r\n        </FormItem>\r\n      </Form>\r\n      <div slot=\"footer\">\r\n        <Button type=\"text\" @click=\"cancel\" class=\"margin-right-10\">取消</Button>\r\n        <Button type=\"primary\" @click=\"submit\" :loading=\"modalSetting.loading\">确定</Button>\r\n      </div>\r\n    </Modal>\r\n    <Modal v-model=\"authSetting.show\" width=\"668\" :styles=\"{top: '30px'}\" @on-visible-change=\"doCancel\">\r\n      <p slot=\"header\" style=\"color:#2d8cf0\">\r\n        <Icon type=\"md-alert\"></Icon>\r\n        <span>{{formItem.id ? '设置' : '新增'}}权限</span>\r\n      </p>\r\n      <div style=\"max-height: 560px;overflow: auto;\">\r\n        <Tree ref=\"formTree\" :data=\"ruleList\" show-checkbox multiple></Tree>\r\n      </div>\r\n      <div slot=\"footer\">\r\n        <Button type=\"text\" @click=\"authSetting.show = false\" class=\"margin-right-10\">取消</Button>\r\n        <Button type=\"primary\" @click=\"authEdit\" :loading=\"authSetting.loading\">确定</Button>\r\n      </div>\r\n    </Modal>\r\n    <Modal v-model=\"memberSetting.show\" width=\"998\" :styles=\"{top: '30px'}\">\r\n      <p slot=\"header\" style=\"color:#2d8cf0\">\r\n        <Icon type=\"information-circled\"></Icon>\r\n        <span>组成员列表</span>\r\n      </p>\r\n      <div>\r\n        <Table :loading=\"memberLoading\" :columns=\"memberColumns\" :data=\"memberData\" border disabled-hover></Table>\r\n      </div>\r\n      <div class=\"margin-top-15\" style=\"text-align: center\">\r\n        <Page :total=\"memberShow.listCount\" :current=\"memberShow.currentPage\"\r\n              :page-size=\"memberShow.pageSize\" @on-change=\"changeMemberPage\"\r\n              @on-page-size-change=\"changeMemberSize\" show-elevator show-sizer show-total></Page>\r\n      </div>\r\n      <p slot=\"footer\"></p>\r\n    </Modal>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { getUsers } from '@/api/user'\r\nimport { getList, add, edit, del, delMember, getRuleList, changeStatus, editRule } from '@/api/auth'\r\n\r\nconst editButton = (vm, h, currentRow, index) => {\r\n  if (vm.buttonShow.edit) {\r\n    return h('Button', {\r\n      props: {\r\n        type: 'primary'\r\n      },\r\n      style: {\r\n        margin: '0 5px'\r\n      },\r\n      on: {\r\n        'click': () => {\r\n          vm.formItem.id = currentRow.id\r\n          vm.formItem.name = currentRow.name\r\n          vm.formItem.description = currentRow.description\r\n          vm.modalSetting.show = true\r\n          vm.modalSetting.index = index\r\n        }\r\n      }\r\n    }, vm.$t('edit_button'))\r\n  }\r\n}\r\nconst authButton = (vm, h, currentRow, index) => {\r\n  if (vm.buttonShow.edit) {\r\n    return h('Button', {\r\n      props: {\r\n        type: 'info',\r\n        ghost: true\r\n      },\r\n      style: {\r\n        margin: '0 5px'\r\n      },\r\n      on: {\r\n        'click': () => {\r\n          vm.formItem.id = currentRow.id\r\n          getRuleList({ 'group_id': currentRow.id }).then(response => {\r\n            vm.ruleList = response.data.data.list\r\n          })\r\n          vm.authSetting.show = true\r\n          vm.authSetting.index = index\r\n        }\r\n      }\r\n    }, '设置权限')\r\n  }\r\n}\r\nconst deleteButton = (vm, h, currentRow, index) => {\r\n  if (vm.buttonShow.del) {\r\n    return h('Poptip', {\r\n      props: {\r\n        confirm: true,\r\n        title: '您确定要删除这条数据吗? ',\r\n        transfer: true\r\n      },\r\n      on: {\r\n        'on-ok': () => {\r\n          del(currentRow.id).then(response => {\r\n            vm.tableData.splice(index, 1)\r\n            vm.$Message.success(response.data.msg)\r\n          })\r\n        }\r\n      }\r\n    }, [\r\n      h('Button', {\r\n        style: {\r\n          margin: '0 5px'\r\n        },\r\n        props: {\r\n          type: 'error',\r\n          placement: 'top',\r\n          loading: currentRow.isDeleting\r\n        }\r\n      }, vm.$t('delete_button'))\r\n    ])\r\n  }\r\n}\r\nconst memberButton = (vm, h, currentRow, index) => {\r\n  if (vm.buttonShow.memberList) {\r\n    return h('Button', {\r\n      props: {\r\n        type: 'primary'\r\n      },\r\n      style: {\r\n        margin: '0 5px'\r\n      },\r\n      on: {\r\n        'click': () => {\r\n          vm.memberSetting.show = true\r\n          vm.memberShow.gid = currentRow.id\r\n          vm.getMemberList()\r\n        }\r\n      }\r\n    }, '组成员')\r\n  }\r\n}\r\nconst memberDelButton = (vm, h, currentRow, index) => {\r\n  if (vm.buttonShow.memberDel) {\r\n    return h('Poptip', {\r\n      props: {\r\n        confirm: true,\r\n        title: '您确定要删除这条数据吗? ',\r\n        transfer: true\r\n      },\r\n      on: {\r\n        'on-ok': () => {\r\n          delMember({\r\n            uid: currentRow.id,\r\n            gid: vm.memberShow.gid\r\n          }).then(response => {\r\n            vm.memberData.splice(index, 1)\r\n            vm.$Message.success(response.data.msg)\r\n          })\r\n        }\r\n      }\r\n    }, [\r\n      h('Button', {\r\n        style: {\r\n          margin: '0 5px'\r\n        },\r\n        props: {\r\n          type: 'error',\r\n          placement: 'top',\r\n          loading: currentRow.isDeleting\r\n        }\r\n      }, vm.$t('delete_button'))\r\n    ])\r\n  }\r\n}\r\n\r\nexport default {\r\n  name: 'system_auth',\r\n  data () {\r\n    return {\r\n      ruleList: [],\r\n      columnsList: [\r\n        {\r\n          title: '序号',\r\n          type: 'index',\r\n          width: 65,\r\n          align: 'center'\r\n        },\r\n        {\r\n          title: '权限组',\r\n          align: 'center',\r\n          key: 'name',\r\n          width: 200\r\n        },\r\n        {\r\n          title: '描述',\r\n          align: 'center',\r\n          key: 'description'\r\n        },\r\n        {\r\n          title: '成员授权',\r\n          align: 'center',\r\n          width: 116,\r\n          render: (h, params) => {\r\n            return h('div', [\r\n              memberButton(this, h, params.row, params.index)\r\n            ])\r\n          }\r\n        },\r\n        {\r\n          title: '状态',\r\n          align: 'center',\r\n          width: 100,\r\n          render: (h, params) => {\r\n            let vm = this\r\n            return h('i-switch', {\r\n              attrs: {\r\n                size: 'large'\r\n              },\r\n              props: {\r\n                'true-value': 1,\r\n                'false-value': 0,\r\n                value: params.row.status,\r\n                disabled: !vm.buttonShow.changeStatus\r\n              },\r\n              on: {\r\n                'on-change': function (status) {\r\n                  changeStatus(status, params.row.id).then(response => {\r\n                    vm.$Message.success(response.data.msg)\r\n                    vm.getList()\r\n                  })\r\n                }\r\n              }\r\n            }, [\r\n              h('span', {\r\n                slot: 'open'\r\n              }, vm.$t('open_choose')),\r\n              h('span', {\r\n                slot: 'close'\r\n              }, vm.$t('close_choose'))\r\n            ])\r\n          }\r\n        },\r\n        {\r\n          title: '操作',\r\n          align: 'center',\r\n          width: 285,\r\n          render: (h, params) => {\r\n            return h('div', [\r\n              authButton(this, h, params.row, params.index),\r\n              editButton(this, h, params.row, params.index),\r\n              deleteButton(this, h, params.row, params.index)\r\n            ])\r\n          }\r\n        }\r\n      ],\r\n      memberColumns: [\r\n        {\r\n          title: '序号',\r\n          type: 'index',\r\n          width: 65,\r\n          align: 'center'\r\n        },\r\n        {\r\n          title: '用户账号',\r\n          align: 'center',\r\n          key: 'username'\r\n        },\r\n        {\r\n          title: '用户昵称',\r\n          align: 'center',\r\n          key: 'nickname',\r\n          width: 100\r\n        },\r\n        {\r\n          title: '登录次数',\r\n          align: 'center',\r\n          key: 'login_times',\r\n          width: 100\r\n        },\r\n        {\r\n          title: '最后登录时间',\r\n          align: 'center',\r\n          key: 'last_login_time',\r\n          width: 140\r\n        },\r\n        {\r\n          title: '最后登录IP',\r\n          align: 'center',\r\n          key: 'last_login_ip',\r\n          width: 160\r\n        },\r\n        {\r\n          title: '状态',\r\n          align: 'center',\r\n          width: 100,\r\n          render: (h, params) => {\r\n            if (params.row.status === 1) {\r\n              return h('Tag', {\r\n                props: {\r\n                  'color': 'green'\r\n                }\r\n              }, '启用')\r\n            } else {\r\n              return h('Tag', {\r\n                props: {\r\n                  'color': 'red'\r\n                }\r\n              }, vm.$t('close_choose'))\r\n            }\r\n          }\r\n        },\r\n        {\r\n          title: '操作',\r\n          align: 'center',\r\n          width: 115,\r\n          render: (h, params) => {\r\n            return h('div', [\r\n              memberDelButton(this, h, params.row, params.index)\r\n            ])\r\n          }\r\n        }\r\n      ],\r\n      tableData: [],\r\n      memberData: [],\r\n      tableShow: {\r\n        currentPage: 1,\r\n        pageSize: 10,\r\n        listCount: 0\r\n      },\r\n      memberShow: {\r\n        currentPage: 1,\r\n        pageSize: 10,\r\n        listCount: 0,\r\n        gid: 0\r\n      },\r\n      searchConf: {\r\n        keywords: '',\r\n        status: ''\r\n      },\r\n      modalSetting: {\r\n        show: false,\r\n        loading: false,\r\n        index: 0\r\n      },\r\n      authSetting: {\r\n        show: false,\r\n        loading: false,\r\n        index: 0\r\n      },\r\n      memberSetting: {\r\n        show: false,\r\n        loading: false,\r\n        index: 0\r\n      },\r\n      formItem: {\r\n        name: '',\r\n        description: '',\r\n        rules: [],\r\n        id: 0\r\n      },\r\n      ruleValidate: {\r\n        name: [\r\n          { required: true, message: '组名称不能为空', trigger: 'blur' }\r\n        ]\r\n      },\r\n      buttonShow: {\r\n        edit: true,\r\n        del: true,\r\n        changeStatus: true,\r\n        memberDel: true,\r\n        memberList: true\r\n      },\r\n      listLoading: false,\r\n      memberLoading: false\r\n    }\r\n  },\r\n  created () {\r\n    let vm = this\r\n    vm.getList()\r\n    vm.hasRule('Auth/edit').then(res => {\r\n      vm.buttonShow.edit = res\r\n    })\r\n    vm.hasRule('Auth/del').then(res => {\r\n      vm.buttonShow.del = res\r\n    })\r\n    vm.hasRule('Auth/changeStatus').then(res => {\r\n      vm.buttonShow.changeStatus = res\r\n    })\r\n    vm.hasRule('User/getUsers').then(res => {\r\n      vm.buttonShow.memberList = res\r\n    })\r\n    vm.hasRule('Auth/delMember').then(res => {\r\n      vm.buttonShow.memberDel = res\r\n    })\r\n  },\r\n  methods: {\r\n    authEdit () {\r\n      let vm = this\r\n      vm.formItem.rules = []\r\n      let ruleNodes = vm.$refs['formTree'].getCheckedNodes()\r\n      let ruleLength = ruleNodes.length\r\n      if (ruleLength) {\r\n        for (let i = 0; i <= ruleLength - 1; i++) {\r\n          this.formItem.rules.push(ruleNodes[i]['key'])\r\n        }\r\n      }\r\n\r\n      vm.authSetting.loading = true\r\n      editRule(vm.formItem).then(response => {\r\n        vm.$Message.success(response.data.msg)\r\n        vm.authSetting.show = false\r\n        vm.authSetting.loading = false\r\n      }).catch(() => {\r\n        vm.authSetting.loading = false\r\n      })\r\n    },\r\n    alertAdd () {\r\n      this.modalSetting.show = true\r\n    },\r\n    submit () {\r\n      let vm = this\r\n      this.$refs['myForm'].validate((valid) => {\r\n        if (valid) {\r\n          vm.modalSetting.loading = true\r\n          if (vm.formItem.id === 0) {\r\n            add(vm.formItem).then(response => {\r\n              vm.$Message.success(response.data.msg)\r\n              vm.getList()\r\n              vm.cancel()\r\n            }).catch(() => {\r\n              vm.modalSetting.loading = false\r\n            })\r\n          } else {\r\n            edit(vm.formItem).then(response => {\r\n              vm.$Message.success(response.data.msg)\r\n              vm.getList()\r\n              vm.cancel()\r\n            }).catch(() => {\r\n              vm.modalSetting.loading = false\r\n            })\r\n          }\r\n        }\r\n      })\r\n    },\r\n    cancel () {\r\n      this.modalSetting.show = false\r\n    },\r\n    doCancel (data) {\r\n      if (!data) {\r\n        this.formItem.id = 0\r\n        this.$refs['myForm'].resetFields()\r\n        this.modalSetting.loading = false\r\n        this.modalSetting.index = 0\r\n      }\r\n    },\r\n    changePage (page) {\r\n      this.tableShow.currentPage = page\r\n      this.getList()\r\n    },\r\n    changeSize (size) {\r\n      this.tableShow.pageSize = size\r\n      this.getList()\r\n    },\r\n    changeMemberPage (page) {\r\n      this.memberShow.currentPage = page\r\n      this.getMemberList()\r\n    },\r\n    changeMemberSize (size) {\r\n      this.memberShow.pageSize = size\r\n      this.getMemberList()\r\n    },\r\n    search () {\r\n      this.tableShow.currentPage = 1\r\n      this.getList()\r\n    },\r\n    getList () {\r\n      let vm = this\r\n      let params = {\r\n        page: vm.tableShow.currentPage,\r\n        size: vm.tableShow.pageSize,\r\n        keywords: vm.searchConf.keywords,\r\n        status: vm.searchConf.status\r\n      }\r\n      vm.listLoading = true\r\n      getList(params).then(response => {\r\n        vm.tableData = response.data.data.list\r\n        vm.tableShow.listCount = response.data.data.count\r\n        vm.listLoading = false\r\n      })\r\n    },\r\n    getMemberList () {\r\n      let vm = this\r\n      let params = {\r\n        page: vm.memberShow.currentPage,\r\n        size: vm.memberShow.pageSize,\r\n        gid: vm.memberShow.gid\r\n      }\r\n      vm.memberLoading = true\r\n      getUsers(params).then(response => {\r\n        vm.memberData = response.data.data.list\r\n        vm.memberShow.listCount = response.data.data.count\r\n        vm.memberLoading = false\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n"]}]}