{"remainingRequest":"E:\\ApiAdmin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\ApiAdmin\\src\\components\\main\\components\\tags-nav\\tags-nav.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\ApiAdmin\\src\\components\\main\\components\\tags-nav\\tags-nav.vue","mtime":1635783328967},{"path":"E:\\ApiAdmin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1635783567026},{"path":"E:\\ApiAdmin\\node_modules\\babel-loader\\lib\\index.js","mtime":1635783561745},{"path":"E:\\ApiAdmin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1635783567026},{"path":"E:\\ApiAdmin\\node_modules\\vue-loader\\lib\\index.js","mtime":1635783560295}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { showTitle, routeEqual } from '@/libs/util'\r\nimport beforeClose from '@/router/before-close'\r\nexport default {\r\n  name: 'TagsNav',\r\n  props: {\r\n    value: Object,\r\n    list: {\r\n      type: Array,\r\n      default () {\r\n        return []\r\n      }\r\n    }\r\n  },\r\n  data () {\r\n    return {\r\n      tagBodyLeft: 0,\r\n      rightOffset: 40,\r\n      outerPadding: 4,\r\n      contextMenuLeft: 0,\r\n      contextMenuTop: 0,\r\n      visible: false,\r\n      menuList: {\r\n        others: '关闭其他',\r\n        all: '关闭所有'\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    currentRouteObj () {\r\n      const { name, params, query } = this.value\r\n      return { name, params, query }\r\n    }\r\n  },\r\n  methods: {\r\n    handlescroll (e) {\r\n      var type = e.type\r\n      let delta = 0\r\n      if (type === 'DOMMouseScroll' || type === 'mousewheel') {\r\n        delta = (e.wheelDelta) ? e.wheelDelta : -(e.detail || 0) * 40\r\n      }\r\n      this.handleScroll(delta)\r\n    },\r\n    handleScroll (offset) {\r\n      const outerWidth = this.$refs.scrollOuter.offsetWidth\r\n      const bodyWidth = this.$refs.scrollBody.offsetWidth\r\n      if (offset > 0) {\r\n        this.tagBodyLeft = Math.min(0, this.tagBodyLeft + offset)\r\n      } else {\r\n        if (outerWidth < bodyWidth) {\r\n          if (this.tagBodyLeft < -(bodyWidth - outerWidth)) {\r\n            this.tagBodyLeft = this.tagBodyLeft\r\n          } else {\r\n            this.tagBodyLeft = Math.max(this.tagBodyLeft + offset, outerWidth - bodyWidth)\r\n          }\r\n        } else {\r\n          this.tagBodyLeft = 0\r\n        }\r\n      }\r\n    },\r\n    handleTagsOption (type) {\r\n      if (type.includes('all')) {\r\n        // 关闭所有，除了home\r\n        let res = this.list.filter(item => item.name === 'home')\r\n        this.$emit('on-close', res, 'all')\r\n      } else if (type.includes('others')) {\r\n        // 关闭除当前页和home页的其他页\r\n        let res = this.list.filter(item => routeEqual(this.currentRouteObj, item) || item.name === 'home')\r\n        this.$emit('on-close', res, 'others', this.currentRouteObj)\r\n        setTimeout(() => {\r\n          this.getTagElementByRoute(this.currentRouteObj)\r\n        }, 100)\r\n      }\r\n    },\r\n    handleClose (current) {\r\n      if (current.meta && current.meta.beforeCloseName && current.meta.beforeCloseName in beforeClose) {\r\n        new Promise(beforeClose[current.meta.beforeCloseName]).then(close => {\r\n          if (close) {\r\n            this.close(current)\r\n          }\r\n        })\r\n      } else {\r\n        this.close(current)\r\n      }\r\n    },\r\n    close (route) {\r\n      let res = this.list.filter(item => !routeEqual(route, item))\r\n      this.$emit('on-close', res, undefined, route)\r\n    },\r\n    handleClick (item) {\r\n      this.$emit('input', item)\r\n    },\r\n    showTitleInside (item) {\r\n      return showTitle(item, this)\r\n    },\r\n    isCurrentTag (item) {\r\n      return routeEqual(this.currentRouteObj, item)\r\n    },\r\n    moveToView (tag) {\r\n      const outerWidth = this.$refs.scrollOuter.offsetWidth\r\n      const bodyWidth = this.$refs.scrollBody.offsetWidth\r\n      if (bodyWidth < outerWidth) {\r\n        this.tagBodyLeft = 0\r\n      } else if (tag.offsetLeft < -this.tagBodyLeft) {\r\n        // 标签在可视区域左侧\r\n        this.tagBodyLeft = -tag.offsetLeft + this.outerPadding\r\n      } else if (tag.offsetLeft > -this.tagBodyLeft && tag.offsetLeft + tag.offsetWidth < -this.tagBodyLeft + outerWidth) {\r\n        // 标签在可视区域\r\n        this.tagBodyLeft = Math.min(0, outerWidth - tag.offsetWidth - tag.offsetLeft - this.outerPadding)\r\n      } else {\r\n        // 标签在可视区域右侧\r\n        this.tagBodyLeft = -(tag.offsetLeft - (outerWidth - this.outerPadding - tag.offsetWidth))\r\n      }\r\n    },\r\n    getTagElementByRoute (route) {\r\n      this.$nextTick(() => {\r\n        this.refsTag = this.$refs.tagsPageOpened\r\n        this.refsTag.forEach((item, index) => {\r\n          if (routeEqual(route, item.$attrs['data-route-item'])) {\r\n            let tag = this.refsTag[index].$el\r\n            this.moveToView(tag)\r\n          }\r\n        })\r\n      })\r\n    },\r\n    contextMenu (item, e) {\r\n      if (item.name === 'home') {\r\n        return\r\n      }\r\n      this.visible = true\r\n      const offsetLeft = this.$el.getBoundingClientRect().left\r\n      this.contextMenuLeft = e.clientX - offsetLeft + 10\r\n      this.contextMenuTop = e.clientY - 64\r\n    },\r\n    closeMenu () {\r\n      this.visible = false\r\n    }\r\n  },\r\n  watch: {\r\n    '$route' (to) {\r\n      this.getTagElementByRoute(to)\r\n    },\r\n    visible (value) {\r\n      if (value) {\r\n        document.body.addEventListener('click', this.closeMenu)\r\n      } else {\r\n        document.body.removeEventListener('click', this.closeMenu)\r\n      }\r\n    }\r\n  },\r\n  mounted () {\r\n    setTimeout(() => {\r\n      this.getTagElementByRoute(this.$route)\r\n    }, 200)\r\n  }\r\n}\r\n",{"version":3,"sources":["tags-nav.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"tags-nav.vue","sourceRoot":"src/components/main/components/tags-nav","sourcesContent":["<template>\r\n  <div class=\"tags-nav\">\r\n    <div class=\"close-con\">\r\n      <Dropdown transfer @on-click=\"handleTagsOption\" style=\"margin-top:7px;\">\r\n        <Button size=\"small\" type=\"text\">\r\n          <Icon :size=\"18\" type=\"ios-close-circle-outline\" />\r\n        </Button>\r\n        <DropdownMenu slot=\"list\">\r\n          <DropdownItem name=\"close-all\">关闭所有</DropdownItem>\r\n          <DropdownItem name=\"close-others\">关闭其他</DropdownItem>\r\n        </DropdownMenu>\r\n      </Dropdown>\r\n    </div>\r\n    <ul v-show=\"visible\" :style=\"{left: contextMenuLeft + 'px', top: contextMenuTop + 'px'}\" class=\"contextmenu\">\r\n      <li v-for=\"(item, key) of menuList\" @click=\"handleTagsOption(key)\" :key=\"key\">{{item}}</li>\r\n    </ul>\r\n    <div class=\"btn-con left-btn\">\r\n      <Button type=\"text\" @click=\"handleScroll(240)\">\r\n        <Icon :size=\"18\" type=\"ios-arrow-back\" />\r\n      </Button>\r\n    </div>\r\n    <div class=\"btn-con right-btn\">\r\n      <Button type=\"text\" @click=\"handleScroll(-240)\">\r\n        <Icon :size=\"18\" type=\"ios-arrow-forward\" />\r\n      </Button>\r\n    </div>\r\n    <div class=\"scroll-outer\" ref=\"scrollOuter\" @DOMMouseScroll=\"handlescroll\" @mousewheel=\"handlescroll\">\r\n      <div ref=\"scrollBody\" class=\"scroll-body\" :style=\"{left: tagBodyLeft + 'px'}\">\r\n        <transition-group name=\"taglist-moving-animation\">\r\n          <Tag\r\n            type=\"dot\"\r\n            v-for=\"(item, index) in list\"\r\n            ref=\"tagsPageOpened\"\r\n            :key=\"`tag-nav-${index}`\"\r\n            :name=\"item.name\"\r\n            :data-route-item=\"item\"\r\n            @on-close=\"handleClose(item)\"\r\n            @click.native=\"handleClick(item)\"\r\n            :closable=\"item.name !== 'home'\"\r\n            :color=\"isCurrentTag(item) ? 'primary' : 'default'\"\r\n            @contextmenu.prevent.native=\"contextMenu(item, $event)\"\r\n          >{{ showTitleInside(item) }}</Tag>\r\n        </transition-group>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { showTitle, routeEqual } from '@/libs/util'\r\nimport beforeClose from '@/router/before-close'\r\nexport default {\r\n  name: 'TagsNav',\r\n  props: {\r\n    value: Object,\r\n    list: {\r\n      type: Array,\r\n      default () {\r\n        return []\r\n      }\r\n    }\r\n  },\r\n  data () {\r\n    return {\r\n      tagBodyLeft: 0,\r\n      rightOffset: 40,\r\n      outerPadding: 4,\r\n      contextMenuLeft: 0,\r\n      contextMenuTop: 0,\r\n      visible: false,\r\n      menuList: {\r\n        others: '关闭其他',\r\n        all: '关闭所有'\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    currentRouteObj () {\r\n      const { name, params, query } = this.value\r\n      return { name, params, query }\r\n    }\r\n  },\r\n  methods: {\r\n    handlescroll (e) {\r\n      var type = e.type\r\n      let delta = 0\r\n      if (type === 'DOMMouseScroll' || type === 'mousewheel') {\r\n        delta = (e.wheelDelta) ? e.wheelDelta : -(e.detail || 0) * 40\r\n      }\r\n      this.handleScroll(delta)\r\n    },\r\n    handleScroll (offset) {\r\n      const outerWidth = this.$refs.scrollOuter.offsetWidth\r\n      const bodyWidth = this.$refs.scrollBody.offsetWidth\r\n      if (offset > 0) {\r\n        this.tagBodyLeft = Math.min(0, this.tagBodyLeft + offset)\r\n      } else {\r\n        if (outerWidth < bodyWidth) {\r\n          if (this.tagBodyLeft < -(bodyWidth - outerWidth)) {\r\n            this.tagBodyLeft = this.tagBodyLeft\r\n          } else {\r\n            this.tagBodyLeft = Math.max(this.tagBodyLeft + offset, outerWidth - bodyWidth)\r\n          }\r\n        } else {\r\n          this.tagBodyLeft = 0\r\n        }\r\n      }\r\n    },\r\n    handleTagsOption (type) {\r\n      if (type.includes('all')) {\r\n        // 关闭所有，除了home\r\n        let res = this.list.filter(item => item.name === 'home')\r\n        this.$emit('on-close', res, 'all')\r\n      } else if (type.includes('others')) {\r\n        // 关闭除当前页和home页的其他页\r\n        let res = this.list.filter(item => routeEqual(this.currentRouteObj, item) || item.name === 'home')\r\n        this.$emit('on-close', res, 'others', this.currentRouteObj)\r\n        setTimeout(() => {\r\n          this.getTagElementByRoute(this.currentRouteObj)\r\n        }, 100)\r\n      }\r\n    },\r\n    handleClose (current) {\r\n      if (current.meta && current.meta.beforeCloseName && current.meta.beforeCloseName in beforeClose) {\r\n        new Promise(beforeClose[current.meta.beforeCloseName]).then(close => {\r\n          if (close) {\r\n            this.close(current)\r\n          }\r\n        })\r\n      } else {\r\n        this.close(current)\r\n      }\r\n    },\r\n    close (route) {\r\n      let res = this.list.filter(item => !routeEqual(route, item))\r\n      this.$emit('on-close', res, undefined, route)\r\n    },\r\n    handleClick (item) {\r\n      this.$emit('input', item)\r\n    },\r\n    showTitleInside (item) {\r\n      return showTitle(item, this)\r\n    },\r\n    isCurrentTag (item) {\r\n      return routeEqual(this.currentRouteObj, item)\r\n    },\r\n    moveToView (tag) {\r\n      const outerWidth = this.$refs.scrollOuter.offsetWidth\r\n      const bodyWidth = this.$refs.scrollBody.offsetWidth\r\n      if (bodyWidth < outerWidth) {\r\n        this.tagBodyLeft = 0\r\n      } else if (tag.offsetLeft < -this.tagBodyLeft) {\r\n        // 标签在可视区域左侧\r\n        this.tagBodyLeft = -tag.offsetLeft + this.outerPadding\r\n      } else if (tag.offsetLeft > -this.tagBodyLeft && tag.offsetLeft + tag.offsetWidth < -this.tagBodyLeft + outerWidth) {\r\n        // 标签在可视区域\r\n        this.tagBodyLeft = Math.min(0, outerWidth - tag.offsetWidth - tag.offsetLeft - this.outerPadding)\r\n      } else {\r\n        // 标签在可视区域右侧\r\n        this.tagBodyLeft = -(tag.offsetLeft - (outerWidth - this.outerPadding - tag.offsetWidth))\r\n      }\r\n    },\r\n    getTagElementByRoute (route) {\r\n      this.$nextTick(() => {\r\n        this.refsTag = this.$refs.tagsPageOpened\r\n        this.refsTag.forEach((item, index) => {\r\n          if (routeEqual(route, item.$attrs['data-route-item'])) {\r\n            let tag = this.refsTag[index].$el\r\n            this.moveToView(tag)\r\n          }\r\n        })\r\n      })\r\n    },\r\n    contextMenu (item, e) {\r\n      if (item.name === 'home') {\r\n        return\r\n      }\r\n      this.visible = true\r\n      const offsetLeft = this.$el.getBoundingClientRect().left\r\n      this.contextMenuLeft = e.clientX - offsetLeft + 10\r\n      this.contextMenuTop = e.clientY - 64\r\n    },\r\n    closeMenu () {\r\n      this.visible = false\r\n    }\r\n  },\r\n  watch: {\r\n    '$route' (to) {\r\n      this.getTagElementByRoute(to)\r\n    },\r\n    visible (value) {\r\n      if (value) {\r\n        document.body.addEventListener('click', this.closeMenu)\r\n      } else {\r\n        document.body.removeEventListener('click', this.closeMenu)\r\n      }\r\n    }\r\n  },\r\n  mounted () {\r\n    setTimeout(() => {\r\n      this.getTagElementByRoute(this.$route)\r\n    }, 200)\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\">\r\n@import './tags-nav.less';\r\n</style>\r\n"]}]}